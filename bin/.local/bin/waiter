#!/usr/bin/env bash

# Waiter script: waits for dotfiles install to complete and then launches zsh
# This is useful when connecting to codespaces during setup

MARKER_FILE="$HOME/.dotfiles_complete"
MAX_WAIT=300  # Maximum wait time in seconds (5 minutes)
INTERVAL=2    # Check interval in seconds
elapsed=0

echo "Waiting for dotfiles install to complete..."

# Check for marker file that indicates dotfiles setup is complete
while [ ! -f "$MARKER_FILE" ]; do
    if [ $elapsed -ge $MAX_WAIT ]; then
        echo ""
        echo "Timeout: dotfiles install did not complete within $MAX_WAIT seconds."
        exit 1
    fi
    echo -n "."
    sleep $INTERVAL
    elapsed=$((elapsed + INTERVAL))
done

echo ""
echo "Dotfiles setup complete! Launching zsh..."

if command -v zsh &> /dev/null; then
    exec zsh
else
    echo "Warning: zsh not available, falling back to current shell."
fi
